---
title: "HW 2 Data Science"
author: "Victoria Mello (vsm2118)"
date: "October 4, 2023"
output: github_document
---

# Promblem 1

```{r}
library(tidyverse)
```

Clean and tidy the datasets: 

```{r clean_538_pols}
month_df = 
  tibble(
    month_num = 1:12,
    month_abb = month.abb,
    month = month.name)

pols = 
  read_csv("./data/pols-month.csv") |>
  separate(mon, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    president = recode(prez_gop, "0" = "dem", "1" = "gop", "2" = "gop")) |>
  left_join(x = _, y = month_df) |> 
  select(year, month, everything(), -day, -starts_with("prez")) 
```

```{r clean_538_snp}
snp = 
  read_csv("./data/snp.csv") |>
  separate(date, into = c("month", "day", "year"), convert = TRUE) |>
  arrange(year, month) |>
  mutate(month = month.name[month]) |>
  select(year, month, close) 
```

```{r clean_538_unemp}
unemployment = 
  read_csv("./data/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month_abb",
    values_to = "unemployment"
  ) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, unemployment)
```

Merge the three datasets:

```{r merge_538}
data_538 = 
  left_join(pols, snp) |>
  left_join(x = _, y = unemployment)

str(data_538)
```

The `pols` data has `r nrow(pols)` observations and `r ncol(pols)` variables and tells us about the party affiliation distribution (democrat or republican) for governors and senators for a given year from years `r range(pols$year)[1]` to `r range(pols$year)[2]`. It also tells us whether the sitting president was a democrat or republican. The `snp` data has `r nrow(snp)` observations and `r ncol(snp)` variables, ranging from years `r range(snp$year)[1]` to `r range(snp$year)[2]`. The `unemployment` data has `r nrow(unemployment)` observations and `r ncol(unemployment)` variables ranging from years `r range(unemployment$year)[1]` to `r range(unemployment$year)[2]`. In Januarys in or after 1975 in which a democrat was president, the **average unemployment rate was `r filter(data_538, month == "January", year >= 1975, president == "dem") |> pull(unemployment) |> mean() |> round(2)`**.  The average unemployment rate over the same time period in which a republican was president was `r filter(data_538, month == "January", year >= 1975, president == "gop") |> pull(unemployment) |> mean() |> round(2)`.


# Problem 2

```{r}

# Step 1: Read and clean the Mr. Trash Wheel dataset
mr_trash_wheel <- readxl::read_excel("./trashwheel.xlsx", sheet = "Mr. Trash Wheel") %>%
  janitor::clean_names() %>%
 mutate(homes_powered=(
    (weight_tons*500)/1000),
    year = as.integer(year),
    trash_data = "mr_tw") 

view(mr_trash_wheel)

# Step 2: Import, clean, and organize data for Professor Trash Wheel
professor_trash_wheel <- readxl::read_excel("./trashwheel.xlsx", sheet = "Professor Trash Wheel") %>%
   janitor::clean_names() %>% 
mutate(homes_powered=(
    (weight_tons*500)/1000),
    year = as.integer(year),
    trash_data = "professor_tw")

view(professor_trash_wheel)

# Step 3: Import, clean, and organize data for Gwynnda
gwynnda <- readxl::read_excel("./trashwheel.xlsx", sheet = "Gwynnda Trash Wheel") %>%
  janitor::clean_names() %>% 
mutate(homes_powered=(
    (weight_tons*500)/1000),
    year = as.integer(year),
    trash_data = "gwynnda_tw")

view(gwynnda)

gwynnda_july_2021 =
  gwynnda %>% 
  filter(month == "July") %>% 
  filter(year == "2021")
```

```{r}
# Step 4: Combine the datasets
combined_data <- bind_rows(mr_trash_wheel, professor_trash_wheel, gwynnda) %>% 
  janitor::clean_names()
view(combined_data)
```

The collection of Mr. Trash Wheel datasets contains information about a water-wheel vessel that removes trash from the Inner Harbor in Baltimore, Maryland. This dataset combines data from Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda and has `r nrow(combined_data)` observations and `r ncol(combined_data)` variables. The dataset contains information from the years `r range(combined_data$year)[1]` to `r range(combined_data$year)[2]` and includes key variables such as weight of trash collected in tons, number of cigarette butts, and homes powered where each ton of trash equates to on average 500 kilowatts of electricity. For available data, the total weight of trash collected by Professor Trash Wheel is `r sum(pull(professor_trash_wheel, weight_tons))` and the total number of cigarette butts collected by Gwynnda in July of 2021 is `r sum(pull(gwynnda_july_2021, cigarette_butts))`.


# Problem 3

```{r}

# Read the datasets
MCI_baseline <- read_csv("./data_mci/MCI_baseline.csv")
mci_amyloid <- read_csv("./data_mci/mci_amyloid.csv")

# Rename columns 
MCI_baseline <- MCI_baseline %>%
  rename(
    `ID` = "...1",
    `Age` = "Age at the study baseline",
    `Gender` = "1 = Male, 0 = Female",
    `Education` = "Years of education",
    `APOE4` = "1 = APOE4 carrier, 0 = APOE4 non-carrier",
    `Age_Onset_MCI` = "Age at the onset of MCI; missing if a subject remains MCI free during the follow-up period"
  )

mci_amyloid <- mci_amyloid %>%
  rename(
    `ID` = "Study ID",
    `Time_Elapsed` = "Time (in years) elapsed since the study baseline to the visit where biomarker Amyloid _ 42/40 ratio was measured",
    `Time2` = "NA...3",
    `Time4` = "NA...4",
    `Time6` = "NA...5",
    `Time8` = "NA...6"
  )

```

```{r}
# Clean and tidy the demographic dataset
demographics_clean <- MCI_baseline %>%
  filter(Age_Onset_MCI != ".") %>%
  mutate(Gender = as.factor(Gender),
         APOE4 = as.factor(APOE4))

# Calculate the number of participants and those who develop MCI
num_participants <- nrow(demographics_clean)
num_participants

num_mci <- sum(!is.na(demographics_clean$Age_Onset_MCI))
num_mci

# Convert "." to NA in the Age column
demographics_clean$Age <- ifelse(demographics_clean$Age == ".", NA, demographics_clean$Age)

demographics_clean <- demographics_clean %>%
  mutate(Age = as.numeric(Age))

# Calculate the average baseline age
avg_baseline_age <- mean(demographics_clean$Age, na.rm = TRUE)
avg_baseline_age

# Calculate the proportion of female APOE4 carriers
female_apoe4 <- demographics_clean$APOE4[demographics_clean$Gender == 1]
prop_women_apoe4 <- sum(female_apoe4 == 1) / length(female_apoe4)
prop_women_apoe4

```

```{r}
# Clean and tidy the biomarker dataset
mci_amyloid_clean <- mci_amyloid %>%
  gather(key = "Time", value = "Amyloid_Value", Time_Elapsed:Time8)

# Check for participants that appear in only one of the datasets
participants_demographic <- unique(demographics_clean$ID)
participants_amyloid <- unique(mci_amyloid_clean$ID)
participants_only_demographic <- setdiff(participants_demographic, participants_amyloid)
participants_only_amyloid <- setdiff(participants_amyloid, participants_demographic)

print(participants_only_demographic)
print(participants_only_amyloid)

# Combine the demographic and biomarker datasets
combined_data <- demographics_clean %>%
  inner_join(mci_amyloid_clean, by = "ID")

# Export the resulting dataset as a CSV file
write_csv(combined_data, "./combined_data.csv")

```

